"use strict";(self.webpackChunkqr_scanner=self.webpackChunkqr_scanner||[]).push([[79],{5079:(ue,C,s)=>{s.r(C),s.d(C,{SCANNER_ROUTES:()=>le,ScannerComponent:()=>F});var h=s(6895),d=s(4006),e=s(4650);class U{constructor(o,t){this._document=t;const n=this._textarea=this._document.createElement("textarea"),a=n.style;a.position="fixed",a.top=a.opacity="0",a.left="-999em",n.setAttribute("aria-hidden","true"),n.value=o,n.readOnly=!0,this._document.body.appendChild(n)}copy(){const o=this._textarea;let t=!1;try{if(o){const n=this._document.activeElement;o.select(),o.setSelectionRange(0,o.value.length),t=this._document.execCommand("copy"),n&&n.focus()}}catch{}return t}destroy(){const o=this._textarea;o&&(o.remove(),this._textarea=void 0)}}let J=(()=>{class i{constructor(t){this._document=t}copy(t){const n=this.beginCopy(t),a=n.copy();return n.destroy(),a}beginCopy(t){return new U(t,this._document)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(h.K0))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const _=new e.OlP("CDK_COPY_TO_CLIPBOARD_CONFIG");let N=(()=>{class i{constructor(t,n,a){this._clipboard=t,this._ngZone=n,this.text="",this.attempts=1,this.copied=new e.vpe,this._pending=new Set,a&&null!=a.attempts&&(this.attempts=a.attempts)}copy(t=this.attempts){if(t>1){let n=t;const a=this._clipboard.beginCopy(this.text);this._pending.add(a);const c=()=>{const r=a.copy();r||!--n||this._destroyed?(this._currentTimeout=null,this._pending.delete(a),a.destroy(),this.copied.emit(r)):this._currentTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(c,1))};c()}else this.copied.emit(this._clipboard.copy(this.text))}ngOnDestroy(){this._currentTimeout&&clearTimeout(this._currentTimeout),this._pending.forEach(t=>t.destroy()),this._pending.clear(),this._destroyed=!0}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(J),e.Y36(e.R0b),e.Y36(_,8))},i.\u0275dir=e.lG2({type:i,selectors:[["","cdkCopyToClipboard",""]],hostBindings:function(t,n){1&t&&e.NdJ("click",function(){return n.copy()})},inputs:{text:["cdkCopyToClipboard","text"],attempts:["cdkCopyToClipboardAttempts","attempts"]},outputs:{copied:"cdkCopyToClipboardCopied"}}),i})(),Q=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})();var y=s(4859),v=s(3336),M=s(4144),b=s(455),T=s(266),g=s(347),S=s(945),Y=s(1208),j=s(7579),B=s(6063);class G extends j.x{constructor(o=1/0,t=1/0,n=B.l){super(),this._bufferSize=o,this._windowTime=t,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,o),this._windowTime=Math.max(1,t)}next(o){const{isStopped:t,_buffer:n,_infiniteTimeWindow:a,_timestampProvider:c,_windowTime:r}=this;t||(n.push(o),!a&&n.push(c.now()+r)),this._trimBuffer(),super.next(o)}_subscribe(o){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(o),{_infiniteTimeWindow:n,_buffer:a}=this,c=a.slice();for(let r=0;r<c.length&&!o.closed;r+=n?1:2)o.next(c[r]);return this._checkFinalizedStatuses(o),t}_trimBuffer(){const{_bufferSize:o,_timestampProvider:t,_buffer:n,_infiniteTimeWindow:a}=this,c=(a?1:2)*o;if(o<1/0&&c<n.length&&n.splice(0,n.length-c),!a){const r=t.now();let l=0;for(let u=1;u<n.length&&n[u]<=r;u+=2)l=u;l&&n.splice(0,l+1)}}}var V=s(3099),x=s(4004),D=s(262),H=s(7272),Z=s(5698),P=s(4482),f=s(5403),L=s(5032),k=s(9718),W=s(5577);function A(i,o){return o?t=>(0,H.z)(o.pipe((0,Z.q)(1),function z(){return(0,P.e)((i,o)=>{i.subscribe((0,f.x)(o,L.Z))})}()),t.pipe(A(i))):(0,W.z)((t,n)=>i(t,n).pipe((0,Z.q)(1),(0,k.h)(t)))}var w=s(4986),E=s(5963),X=s(515),$=s(8421),ee=s(2076);let te=(()=>{class i{getCameraStream(t){return this.getMediaStream({video:{facingMode:t?"user":"environment"}})}getMediaStream(t){return(0,ee.D)(navigator.mediaDevices.getUserMedia(t))}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var ne=s(7009);let ie=(()=>{class i{constructor(t){this.matSnackBar=t}success(t){this.show(t,"success")}error(t){this.show(t,"error")}show(t,n=""){this.matSnackBar.open(t,"X",{duration:3e3,horizontalPosition:"right",verticalPosition:"bottom",panelClass:n})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(ne.ux))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var p=s(9549);const oe=["cameraVideo"],ae=["cameraCanvas"],se=["imgCanvas"];function re(i,o){1&i&&(e.TgZ(0,"mat-icon",23),e._uU(1,"qr_code"),e.qZA())}function ce(i,o){1&i&&(e.TgZ(0,"mat-icon",23),e._uU(1,"qr_code"),e.qZA())}const I=function(){return{display:"none"}};let F=(()=>{class i{constructor(t,n){this.mediaDeviceService=t,this.notificationService=n,this.frontCamera=!1,this.data="",this.secretPhrase="",this.cipherText="",this.decryptionEnabled=!1,this.isImgSelected=!1,this.dataMaxLength=g.g.qrDataMaxLength,this.secretKeyMaxlength=g.g.secretKeyMaxLength,this.cipherTextMaxlength=g.g.cipherTextMaxLength}ngOnInit(){this.startScanning()}ngOnDestroy(){this.stopCameraStream()}onRefresh(){this.startScanning(),this.isImgSelected=!1}onImgSelect(t){const n=t.currentTarget,a=n.files;0!=a.length&&S.u.scanCodeFromImgFile(a[0],this.imgCanvasRef.nativeElement,!1).subscribe({next:l=>{this.setScanResult(l),n.value="",this.stopCameraStream(),this.isImgSelected=!0,l||this.resetDataAndCipher()},error:l=>{this.resetDataAndCipher(),console.error(l)}})}onDecryptionToggle(){this.decryptionEnabled=!this.decryptionEnabled,this.decryptionEnabled||(this.data=this.cipherText,this.cipherText=""),this.decryptionEnabled&&(this.cipherText=this.data,this.setDecryptedData())}onSecretPhraseChange(t){this.secretPhrase=t,this.setDecryptedData()}setDecryptedData(){const t=Y.p.decrypt(this.cipherText,this.secretPhrase);this.data=t||"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u0442\u044c"}stopCameraStream(){this.playVideoSubscription&&this.playVideoSubscription.unsubscribe()}startScanning(){this.stopCameraStream(),this.playVideoSubscription=this.playVideoFromCamera().pipe(function K(i,o,t){let n,a=!1;return i&&"object"==typeof i?({bufferSize:n=1/0,windowTime:o=1/0,refCount:a=!1,scheduler:t}=i):n=i??1/0,(0,V.B)({connector:()=>new G(n,o,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}(1),(0,x.U)(t=>(this.scanning=t.active,this.scan())),(0,D.K)(t=>{throw this.scanning=!1,this.resetDataAndCipher(),t}),A(t=>function O(i=0,o=w.z){return i<0&&(i=0),(0,E.H)(i,i,o)}(t?5e3:300)),function q(i){let t,o=1/0;return null!=i&&("object"==typeof i?({count:o=1/0,delay:t}=i):o=i),o<=0?()=>X.E:(0,P.e)((n,a)=>{let r,c=0;const l=()=>{if(r?.unsubscribe(),r=null,null!=t){const m="number"==typeof t?(0,E.H)(t):(0,$.Xf)(t(c)),R=(0,f.x)(a,()=>{R.unsubscribe(),u()});m.subscribe(R)}else u()},u=()=>{let m=!1;r=n.subscribe((0,f.x)(a,void 0,()=>{++c<o?r?l():m=!0:a.complete()})),m&&l()};u()})}()).subscribe()}scan(){const t=S.u.scanCodeFromVideo(this.cameraVideoRef.nativeElement,this.cameraCanvasRef.nativeElement,!0);return this.setScanResult(t),t}setScanResult(t){t&&this.decryptionEnabled&&(this.cipherText=t,this.setDecryptedData()),t&&!this.decryptionEnabled&&(this.data=t),t&&this.notificationService.success("QR-\u043a\u043e\u0434 \u043e\u0442\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d!")}resetDataAndCipher(){this.data="",this.cipherText=""}playVideoFromCamera(){return this.mediaDeviceService.getCameraStream(this.frontCamera).pipe((0,x.U)(t=>(this.cameraVideoRef.nativeElement.srcObject=t,t)),(0,D.K)(t=>{throw this.notificationService.error("\n                    \u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043a\u0430\u043c\u0435\u0440\u0435!\n                    \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u043d\u0430 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043a\u0430\u043c\u0435\u0440\u0435\n                "),t}))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(te),e.Y36(ie))},i.\u0275cmp=e.Xpm({type:i,selectors:[["qr-scanner"]],viewQuery:function(t,n){if(1&t&&(e.Gf(oe,7),e.Gf(ae,7),e.Gf(se,7)),2&t){let a;e.iGM(a=e.CRH())&&(n.cameraVideoRef=a.first),e.iGM(a=e.CRH())&&(n.cameraCanvasRef=a.first),e.iGM(a=e.CRH())&&(n.imgCanvasRef=a.first)}},standalone:!0,features:[e.jDz],decls:52,vars:23,consts:[[1,"header"],["color","accent",3,"ngModel","ngModelChange"],["mat-raised-button","","color","accent",1,"align-center",3,"click"],["mat-icon-button","","matTooltip","\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f",3,"click"],["hidden","","type","file","accept","image/png, image/gif, image/jpeg",3,"change"],["fileInput",""],["appearance","outline",1,"camera-video",3,"ngStyle"],["autoplay","","playsinline","","width","100%","height","100%"],["cameraVideo",""],[2,"display","none"],["cameraCanvas",""],[1,"img",3,"ngStyle"],["imgCanvas",""],[1,"fields"],[1,"field-container"],["appearance","outline",1,"field"],["matInput","","rows","3","maxlength","500","disabled","",3,"ngModel","ngModelChange"],["matSuffix","",4,"ngIf"],["align","end"],["mat-icon-button","","matTooltip","\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430",1,"copy-btn",3,"cdkCopyToClipboard"],["color","accent",1,"enable-decryption","field",3,"ngModel","toggleChange"],["matInput","","rows","3",3,"maxlength","disabled","ngModel","ngModelChange"],["matInput","","rows","3","disabled","",3,"maxlength","ngModel"],["matSuffix",""]],template:function(t,n){if(1&t){const a=e.EpF();e.TgZ(0,"section",0)(1,"mat-slide-toggle",1),e.NdJ("ngModelChange",function(r){return n.frontCamera=r}),e._uU(2,"\u0424\u0440\u043e\u043d\u0442\u0430\u043b\u044c\u043d\u0430\u044f"),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return n.onRefresh()}),e.TgZ(4,"mat-icon"),e._uU(5,"refresh"),e.qZA(),e._uU(6," \u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c "),e.qZA(),e.TgZ(7,"button",3),e.NdJ("click",function(){e.CHM(a);const r=e.MAs(11);return e.KtG(r.click())}),e.TgZ(8,"mat-icon"),e._uU(9," attach_file"),e.qZA()(),e.TgZ(10,"input",4,5),e.NdJ("change",function(r){return n.onImgSelect(r)}),e.qZA()(),e.TgZ(12,"section",6),e._UZ(13,"video",7,8)(15,"canvas",9,10),e.qZA(),e._UZ(17,"canvas",11,12),e.TgZ(19,"section",13)(20,"div",14)(21,"mat-form-field",15)(22,"mat-label"),e._uU(23,"\u0414\u0430\u043d\u043d\u044b\u0435"),e.qZA(),e.TgZ(24,"textarea",16),e.NdJ("ngModelChange",function(r){return n.data=r}),e._uU(25,"            "),e.qZA(),e.YNc(26,re,2,0,"mat-icon",17),e.TgZ(27,"mat-hint",18),e._uU(28),e.qZA()(),e.TgZ(29,"button",19)(30,"mat-icon"),e._uU(31,"content_copy"),e.qZA()()(),e.TgZ(32,"div",14)(33,"mat-slide-toggle",20),e.NdJ("toggleChange",function(){return n.onDecryptionToggle()}),e._uU(34," \u0420\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u0435 "),e.qZA()(),e.TgZ(35,"div",14)(36,"mat-form-field",15)(37,"mat-label"),e._uU(38,"\u0421\u0435\u043a\u0440\u0435\u0442\u043d\u0430\u044f \u0444\u0440\u0430\u0437\u0430"),e.qZA(),e.TgZ(39,"textarea",21),e.NdJ("ngModelChange",function(r){return n.onSecretPhraseChange(r)}),e._uU(40,"            "),e.qZA(),e.TgZ(41,"mat-hint",18),e._uU(42),e.qZA()()(),e.TgZ(43,"div",14)(44,"mat-form-field",15)(45,"mat-label"),e._uU(46,"\u0428\u0438\u0444\u0440"),e.qZA(),e.TgZ(47,"textarea",22),e._uU(48,"            "),e.qZA(),e.YNc(49,ce,2,0,"mat-icon",17),e.TgZ(50,"mat-hint",18),e._uU(51),e.qZA()()()()}2&t&&(e.xp6(1),e.Q6J("ngModel",n.frontCamera),e.xp6(11),e.ekj("scanning",n.scanning),e.Q6J("ngStyle",n.isImgSelected&&e.DdM(21,I)),e.xp6(5),e.Q6J("ngStyle",!n.isImgSelected&&e.DdM(22,I)),e.xp6(7),e.Q6J("ngModel",n.data),e.xp6(2),e.Q6J("ngIf",!n.decryptionEnabled),e.xp6(2),e.AsE("",n.data.length,"/",n.dataMaxLength,""),e.xp6(1),e.Q6J("cdkCopyToClipboard",n.data),e.xp6(4),e.Q6J("ngModel",n.decryptionEnabled),e.xp6(6),e.Q6J("maxlength",n.secretKeyMaxlength)("disabled",!n.decryptionEnabled)("ngModel",n.secretPhrase),e.xp6(3),e.AsE("",n.secretPhrase.length,"/",n.secretKeyMaxlength,""),e.xp6(5),e.Q6J("maxlength",n.cipherTextMaxlength)("ngModel",n.cipherText),e.xp6(2),e.Q6J("ngIf",n.decryptionEnabled),e.xp6(2),e.AsE("",n.cipherText.length,"/",n.cipherTextMaxlength,""))},dependencies:[h.ez,h.O5,h.PC,d.u5,d.Fj,d.JJ,d.nD,d.On,Q,N,b.rP,b.Rr,y.ot,y.lW,v.Ps,v.Hw,M.c,p.KE,p.bx,p.hX,p.R9,M.Nt,T.AV,T.gM],styles:['[_nghost-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;align-self:center}.header[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:15px}.header[_ngcontent-%COMP%], .camera-video[_ngcontent-%COMP%], .img-container[_ngcontent-%COMP%]{margin-bottom:15px}.fields[_ngcontent-%COMP%]   .field-container[_ngcontent-%COMP%]{display:flex}.fields[_ngcontent-%COMP%]   .field-container[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{flex-grow:1}.fields[_ngcontent-%COMP%]   .field-container[_ngcontent-%COMP%]   .copy-btn[_ngcontent-%COMP%]{margin-left:5px}.fields[_ngcontent-%COMP%]   .field-container[_ngcontent-%COMP%]   .enable-decryption[_ngcontent-%COMP%]{margin-bottom:5px}.camera-video[_ngcontent-%COMP%], .img[_ngcontent-%COMP%]{height:240px;width:320px}@keyframes scanning{to{transform:translateY(240px)}}.camera-video[_ngcontent-%COMP%]{display:flex;background:black;position:relative}.camera-video.scanning[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;width:inherit;height:2px;background:linear-gradient(to bottom,#FFFAA0,transparent);animation:scanning 2s linear infinite alternate}.camera-video[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{object-fit:cover}']}),i})();const le=[{path:"",component:F}]}}]);